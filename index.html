<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LeafTag - Invent√°rio Florestal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2c5e3f">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div id="mainScreen" class="screen active">
    <div class="main-logo">üå≤</div>
    <h1>LeafTag - Invent√°rio Florestal</h1>
    <p class="main-subtitle">Coleta r√°pida e eficiente de dados florestais</p>
    <button class="menu-btn" onclick="goTo('inventoryScreen')">Meus Invent√°rios</button>
    <button class="menu-btn" onclick="novoInventario()">+ Nova Coleta</button>
    <button class="menu-btn" onclick="goTo('templatesScreen')">Modelos Padr√£o</button>
    <!-- <button class="menu-btn" onclick="goTo('statisticsScreen')">üìä Estat√≠sticas</button> -->
  </div>

  <div id="inventoryScreen" class="screen">
    <h2>Meus Invent√°rios</h2>
    <div id="inventoryList"></div>
    <button class="menu-btn" onclick="novoInventario()">+ Nova Coleta de Dados</button>
    <button class="btn-back" onclick="goTo('mainScreen')">Voltar</button>
  </div>

  <div id="inventorySetupScreen" class="screen">
    <h2>Configurar Invent√°rio</h2>
    <input type="text" id="inventoryName" placeholder="Nome do invent√°rio" />
    <input type="text" id="inventoryLocation" placeholder="Local do invent√°rio" />
    
    <div class="plot-area-section">
      <h3>üìê √Årea da Parcela:</h3>
      <div class="plot-inputs">
        <input type="number" id="plotArea" placeholder="√Årea da parcela (m¬≤)" step="0.01" />
        <div class="plot-calculator">
          <p><strong>Ou calcular:</strong></p>
          <div class="calc-inputs">
            <input type="number" id="plotWidth" placeholder="Largura (m)" step="0.1" />
            <span>√ó</span>
            <input type="number" id="plotLength" placeholder="Comprimento (m)" step="0.1" />
            <button type="button" onclick="calcularAreaParcela()" class="btn-calc">Calcular</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="template-section">
      <h3>Usar modelo padr√£o:</h3>
      <select id="templateSelect" onchange="aplicarTemplate()">
        <option value="">Selecionar modelo...</option>
        <option value="basico">B√°sico (Nome + CAP + DAP)</option>
        <option value="completo">Completo (Todos os campos)</option>
        <option value="rapido">R√°pido (Apenas essenciais)</option>
      </select>
    </div>
    
    <h3>Selecione as colunas para coleta:</h3>
    <div id="columnOptions">
      <label class="checkbox-option">
        <input type="checkbox" value="nomePopular" checked> Nome Popular
      </label>
      <label class="checkbox-option">
        <input type="checkbox" value="nomeCientifico"> Nome Cient√≠fico
      </label>
      <label class="checkbox-option">
        <input type="checkbox" value="familia"> Fam√≠lia
      </label>
      <label class="checkbox-option">
        <input type="checkbox" value="cap"> CAP (cm)
      </label>
      <label class="checkbox-option">
        <input type="checkbox" value="dap"> DAP (cm)
      </label>
      <label class="checkbox-option">
        <input type="checkbox" value="hc"> HC - Altura Comercial (m)
      </label>
      <label class="checkbox-option">
        <input type="checkbox" value="ht"> HT - Altura Total (m)
      </label>
      <label class="checkbox-option">
        <input type="checkbox" value="coordenadas"> üìç Coordenadas GPS
      </label>
      <label class="checkbox-option">
        <input type="checkbox" value="observacoes"> Observa√ß√µes
      </label>
    </div>

    <div class="custom-column-section">
      <h3>Colunas Personalizadas:</h3>
      <div id="customColumns"></div>
      <button type="button" onclick="adicionarColunaPersonalizada()" class="btn-secondary">+ Adicionar Coluna</button>
    </div>

    <button onclick="iniciarInventario()" class="menu-btn">Iniciar Coleta</button>
    <button class="btn-back" onclick="goTo('inventoryScreen')">Cancelar</button>
  </div>

  <div id="inventoryCollectionScreen" class="screen">
    <div class="inventory-header">
      <h2 id="inventoryTitle"></h2>
      <div class="inventory-counter">
        <span id="currentIndividual">Indiv√≠duo 1</span>
      </div>
    </div>

    <div id="dataCollectionCards"></div>

    <!-- SE√á√ÉO: M√öLTIPLOS FUSTES -->
    <div class="multiple-stems-section">
      <label class="checkbox-option multiple-stems-toggle">
        <input type="checkbox" id="multipleStems" onchange="toggleMultipleStems()"> 
        <span class="package-info">
          <strong>üå≥ √Årvore com m√∫ltiplos fustes</strong><br>
          <small>Adicionar CAP e altura para cada fuste separadamente</small>
        </span>
      </label>
      
      <div id="stemsContainer" style="display: none;">
        <h3>üìè Fustes da √Årvore:</h3>
        <div id="stemsList"></div>
        <button type="button" onclick="adicionarFuste()" class="btn-secondary">+ Adicionar Fuste</button>
      </div>
    </div>

    <div class="inventory-actions">
      <button onclick="salvarIndividuo()" class="menu-btn">Pr√≥ximo Indiv√≠duo</button>
      <button onclick="salvarEContinuar()" class="btn-continue">Salvar e Continuar</button>
      <button onclick="finalizarInventario()" class="btn-secondary">Finalizar Invent√°rio</button>
      <button class="btn-back" onclick="voltarParaInventario()">Cancelar</button>
    </div>
  </div>

  <div id="inventoryDetailScreen" class="screen">
    <div class="inventory-detail-header">
      <h2 id="inventoryDetailTitle"></h2>
      <div id="inventoryDetailInfo"></div>
    </div>

    <div class="inventory-table-container">
      <div id="inventoryTable"></div>
    </div>

    <div class="inventory-detail-actions">
      <button onclick="continuarInventario()" class="menu-btn">Continuar Coleta</button>
      <button onclick="duplicarInventario()" class="btn-secondary">Duplicar Configura√ß√£o</button>
      <button onclick="abrirModalExport()" class="btn-download">üì• Download Excel</button>
      <button onclick="excluirInventario()" class="btn-danger">Excluir Invent√°rio</button>
      <button class="btn-back" onclick="goTo('inventoryScreen')">Voltar</button>
    </div>
  </div>

  <div id="editIndividualScreen" class="screen">
    <div class="inventory-header">
      <h2 id="editIndividualTitle">Editar Indiv√≠duo</h2>
      <div class="inventory-counter">
        <span id="editIndividualNumber"></span>
      </div>
    </div>

    <div id="editDataCollectionCards"></div>

    <!-- SE√á√ÉO: M√öLTIPLOS FUSTES NA EDI√á√ÉO -->
    <div class="multiple-stems-section">
      <label class="checkbox-option multiple-stems-toggle">
        <input type="checkbox" id="editMultipleStems" onchange="toggleEditMultipleStems()"> 
        <span class="package-info">
          <strong>üå≥ √Årvore com m√∫ltiplos fustes</strong><br>
          <small>Editar CAP e altura para cada fuste separadamente</small>
        </span>
      </label>
      
      <div id="editStemsContainer" style="display: none;">
        <h3>üìè Fustes da √Årvore:</h3>
        <div id="editStemsList"></div>
        <button type="button" onclick="adicionarFusteEdit()" class="btn-secondary">+ Adicionar Fuste</button>
      </div>
    </div>

    <div class="inventory-actions">
      <button onclick="salvarEdicaoIndividuo()" class="menu-btn">Salvar Altera√ß√µes</button>
      <button class="btn-back" onclick="cancelarEdicaoIndividuo()">Cancelar</button>
    </div>
  </div>

  <div id="templatesScreen" class="screen">
    <h2>Modelos Padr√£o</h2>
    <div id="templatesList">
      <div class="template-card" onclick="carregarTemplate('basico')">
        <h3>B√°sico</h3>
        <p>Nome Popular, CAP, DAP</p>
        <small>3 campos ‚Ä¢ Coleta r√°pida</small>
      </div>
      <div class="template-card" onclick="carregarTemplate('completo')">
        <h3>Completo</h3>
        <p>Todos os campos dispon√≠veis</p>
        <small>9 campos ‚Ä¢ An√°lise detalhada</small>
      </div>
      <div class="template-card" onclick="carregarTemplate('rapido')">
        <h3>R√°pido</h3>
        <p>Apenas dados essenciais</p>
        <small>4 campos ‚Ä¢ Campo otimizado</small>
      </div>
    </div>
    <button class="btn-back" onclick="goTo('mainScreen')">Voltar</button>
  </div>

 <!-- 
<div id="statisticsScreen" class="screen">
  <h2>Estat√≠sticas</h2>
  <div id="statsContainer">
    <div style="text-align: center; padding: 40px;">
      <h3>üìä Estat√≠sticas Gerais</h3>
      <p>Funcionalidade em desenvolvimento...</p>
    </div>
  </div>
  <button class="btn-back" onclick="goTo('mainScreen')">Voltar</button>
</div>
-->

  <!-- MODAL: SELE√á√ÉO DE C√ÅLCULOS -->
  <div id="exportModal" class="modal-overlay">
    <div class="modal-box export-modal">
      <h3>üìä Selecionar C√°lculos para Export</h3>
      
      <div class="export-options">
        <h4>üî• Pacotes de C√°lculos:</h4>
        <div class="package-options">
          <label class="package-option">
            <input type="radio" name="exportPackage" value="dados" checked> 
            <span class="package-info">
              <strong>Apenas Dados Brutos</strong><br>
              <small>Tabela original sem c√°lculos</small>
            </span>
          </label>
          
          <label class="package-option">
            <input type="radio" name="exportPackage" value="basico"> 
            <span class="package-info">
              <strong>üå≤ B√°sico</strong><br>
              <small>DAP, √Årea Basal, Volume, Densidade</small>
            </span>
          </label>
          
          <label class="package-option">
            <input type="radio" name="exportPackage" value="completo"> 
            <span class="package-info">
              <strong>üìä Completo</strong><br>
              <small>Todos os c√°lculos dispon√≠veis</small>
            </span>
          </label>
          
          <label class="package-option">
            <input type="radio" name="exportPackage" value="customizado"> 
            <span class="package-info">
              <strong>üéØ Customizado</strong><br>
              <small>Escolher individualmente</small>
            </span>
          </label>
        </div>

        <div id="customCalculations" class="custom-calculations" style="display: none;">
          <h4>üìê C√°lculos Individuais:</h4>
          <div class="calc-options">
            <label class="calc-option">
              <input type="checkbox" value="dap_calculado"> DAP Calculado (quando s√≥ tem CAP)
            </label>
            <label class="calc-option">
              <input type="checkbox" value="area_seccional"> √Årea Seccional Individual (g)
            </label>
            <label class="calc-option">
              <input type="checkbox" value="volume_individual"> Volume Individual
            </label>
            <label class="calc-option">
              <input type="checkbox" value="area_basal_ha"> √Årea Basal por Hectare
            </label>
            <label class="calc-option">
              <input type="checkbox" value="volume_ha"> Volume por Hectare
            </label>
            <label class="calc-option">
              <input type="checkbox" value="densidade_ha"> Densidade por Hectare
            </label>
            <label class="calc-option">
              <input type="checkbox" value="dap_medio"> DAP M√©dio Quadr√°tico
            </label>
          </div>
        </div>

        <div class="export-settings">
          <h4>‚öôÔ∏è Configura√ß√µes:</h4>
          <div class="setting-input">
            <label>Fator de Forma para Volume:</label>
            <input type="number" id="fatorForma" value="0.5" step="0.01" min="0.1" max="1.0" />
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button onclick="executarExport()" class="btn-download">üì• Exportar</button>
        <button onclick="fecharModalExport()" class="btn-back">Cancelar</button>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>